<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.dna.moe","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":{"disqus":{"text":"Load Disqus","order":-1}}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="TL;DR Bandori Database will be renamed to Bandori Top with new domain bandori.top. The old domains bandori.ga and bangdream.ga will be abandoned in the near future. All requests to old domains will be">
<meta property="og:type" content="article">
<meta property="og:title" content="Coming breaking changes about Bandori Database, the future and more">
<meta property="og:url" content="https://blog.dna.moe/2020/07/16/coming-changes-bandori-database/index.html">
<meta property="og:site_name" content="DNARoma's DevOps Blog">
<meta property="og:description" content="TL;DR Bandori Database will be renamed to Bandori Top with new domain bandori.top. The old domains bandori.ga and bangdream.ga will be abandoned in the near future. All requests to old domains will be">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-07-16T12:07:23.000Z">
<meta property="article:modified_time" content="2022-07-17T20:03:32.692Z">
<meta property="article:author" content="DNARoma">
<meta property="article:tag" content="Bandori Database">
<meta property="article:tag" content="Breaking Changes">
<meta property="article:tag" content="Bandori Top">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.dna.moe/2020/07/16/coming-changes-bandori-database/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Coming breaking changes about Bandori Database, the future and more | DNARoma's DevOps Blog</title>
  
    <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-125808664-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-125808664-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/rss2.xml" title="DNARoma's DevOps Blog" type="application/rss+xml">
</head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">DNARoma's DevOps Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">DevOps Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-fa fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-fa fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-fa fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-fa fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-fa fa-th"></i>Categories</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://blog.dna.moe/2020/07/16/coming-changes-bandori-database/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DNARoma">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DNARoma's DevOps Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Coming breaking changes about Bandori Database, the future and more
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-16 14:07:23" itemprop="dateCreated datePublished" datetime="2020-07-16T14:07:23+02:00">2020-07-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-07-17 22:03:32" itemprop="dateModified" datetime="2022-07-17T22:03:32+02:00">2022-07-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Website/" itemprop="url" rel="index"><span itemprop="name">Website</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-users"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="firestore-visitors-count"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR"></a>TL;DR</h2><ul>
<li><code>Bandori Database</code> will be <strong>renamed</strong> to <code>Bandori Top</code> with new domain <a target="_blank" rel="noopener" href="https://bandori.top/">bandori.top</a>.</li>
<li>The old domains <em>bandori.ga</em> and <em>bangdream.ga</em> will be abandoned in the near future.</li>
<li>All requests to old domains will be <code>301 permanent redirect</code> to new domain.</li>
<li>More stable and robust auto update of datas and assets.</li>
<li>New design of pages and offline cache.</li>
<li><a target="_blank" rel="noopener" href="https://www.transifex.com/bandori-top/bandori-top-website/">Crowdin Translation</a> support.</li>
</ul>
<span id="more"></span>

<h2 id="Domain-and-name-changes"><a href="#Domain-and-name-changes" class="headerlink" title="Domain and name changes"></a>Domain and name changes</h2><p>I configured an automatic update of the certificates for my domains, but about two weeks before, someone reported that the cert of my api server was expired. I thought it must be the scripts not working again. Unfortunately, I manually ran the command, then error occurred. The log showed a strange error message:</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span><span class="attr">"error"</span><span class="punctuation">:</span> <span class="string">"You cannot use this API for domains with a .cf, .ga, .gq, .ml, or .tk TLD (top-level domain). To configure the DNS settings for this domain, use the Cloudflare Dashboard."</span><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>
<p>It was really a shock for me. After some googling I realized that CloudFlare <a target="_blank" rel="noopener" href="https://community.cloudflare.com/t/unable-to-update-ddns-using-api-for-some-tlds/167228">banned free domains from using API</a>. I mainly use CloudFlare API for assign wildcard certificates, and from now on I can’t do it anymore with my “free” domains. It reminds me of the fact that anything free may be not stable. OK, it’s time to say goodbye to free domains.</p>
<p>After some search acorss different domains and domain registrars, I picked <code>bandori.top</code>. I will move all <code>Bandori Database</code> services to this domain, and, to match the new domain, I made the decision rename it to <code>Bandori Top</code>.</p>
<h2 id="Website-changes"><a href="#Website-changes" class="headerlink" title="Website changes"></a>Website changes</h2><p>It’s been a quiet long time that I didn’t change anything on Bandori Database except bug fixes. I planned some features before but they still on the pending feature list. To tell the truth, I’m not good at designing, and the user expericence of Bandori Database is far from convenient. Sometimes the auto update feature also fails. In the past months I made some changes about backend, making it more reliable and robust, and they are not public at this moment. As the changes is so breaking, I have to modify a lot of codes of frontend and API, so I decided to improve Bandori Database and introduce some new features.</p>
<p>The following parts might contain some technical details and are not friendly for normal users.</p>
<h3 id="Backend-and-API"><a href="#Backend-and-API" class="headerlink" title="Backend and API"></a>Backend and API</h3><p><code>Bandori Top API Service</code> is a RESTful API service. Current versioning, from start of service never changed, is <code>v1</code>. But because the backend will directly use the proto definition extracted from the code, many entries and key names are changed, most api will have a new version <code>v2</code>. As <code>v1</code> endpoints may still work, some key may have changed and you should follow those changes to prevent crash of your programs which use <code>Bandori Top API Service</code>.</p>
<h3 id="New-page-design"><a href="#New-page-design" class="headerlink" title="New page design"></a>New page design</h3><p>I have to say, I’m not good at representing data in a “beautiful” way. I decided to redesign the pages again to make them more clear and to display more <strong>useful</strong> information. Gachas will be removed from home page and moved to separate page. Event history will be presented in a new page supporting by a backend database. Card detail and song detail page will also have more information.</p>
<h3 id="Bug-fixes"><a href="#Bug-fixes" class="headerlink" title="Bug fixes"></a>Bug fixes</h3><p>Yet some bugs make some important features unavailable, like Live2D and music chart viewer. They have something to do with backend and with new backend version they will be fixed.</p>
<h3 id="Crowdin-Translation"><a href="#Crowdin-Translation" class="headerlink" title="Crowdin Translation"></a>Crowdin Translation</h3><p><code>Bandori Top</code> support multi languages, but some translations are missing in Korean and Japanese. Now with new Crowdin Translation feature, you can help improving the translations! More info see <a target="_blank" rel="noopener" href="https://www.transifex.com/bandori-top/bandori-top-website/">project page</a>. You may need a account for submitting new translations, and I can invite you to collaborate.</p>
<h3 id="Offline-cache-with-IndexedDB"><a href="#Offline-cache-with-IndexedDB" class="headerlink" title="Offline cache with IndexedDB"></a>Offline cache with IndexedDB</h3><p><code>IndexedDB</code> is a useful tool for <code>Progressive Web Appliaction (PWA)</code>. PWA is aimed to create “experience like native apps”, so offline use and offline cache is important to such apps. <code>IndexedDB</code> is the tool exact for this task. And with offline cache, your access to <code>Bandori Top</code> will be blazing fast because most data will be retrieved from cache. I will do some optimizations to ensure cached data up to date and you will not see deprecated data if you are online.</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Bandori-Database/" rel="tag"># Bandori Database</a>
              <a href="/tags/Breaking-Changes/" rel="tag"># Breaking Changes</a>
              <a href="/tags/Bandori-Top/" rel="tag"># Bandori Top</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/16/auto-gen-bang-proto-v2/" rel="prev" title="Generating Proto File For Bangdream 4.0.0 (V2)">
      <i class="fa fa-chevron-left"></i> Generating Proto File For Bangdream 4.0.0 (V2)
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/07/31/study-k8s-with-microk8s/" rel="next" title="First Kubernetes deployment with microk8s and cert-manager">
      First Kubernetes deployment with microk8s and cert-manager <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#TL-DR"><span class="nav-number">1.</span> <span class="nav-text">TL;DR</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Domain-and-name-changes"><span class="nav-number">2.</span> <span class="nav-text">Domain and name changes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Website-changes"><span class="nav-number">3.</span> <span class="nav-text">Website changes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend-and-API"><span class="nav-number">3.1.</span> <span class="nav-text">Backend and API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#New-page-design"><span class="nav-number">3.2.</span> <span class="nav-text">New page design</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bug-fixes"><span class="nav-number">3.3.</span> <span class="nav-text">Bug fixes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crowdin-Translation"><span class="nav-number">3.4.</span> <span class="nav-text">Crowdin Translation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Offline-cache-with-IndexedDB"><span class="nav-number">3.5.</span> <span class="nav-text">Offline cache with IndexedDB</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">DNARoma</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/dnaroma" title="GitHub → https://github.com/dnaroma" rel="noopener" target="_blank"><i class="fa fa-fw fa-fab fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/miku_zura" title="Twitter → https://twitter.com/miku_zura" rel="noopener" target="_blank"><i class="fa fa-fw fa-fab fa-twitter"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  © 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">DNARoma</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        




  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.3.3/firebase-firestore.js"></script>
  <script>
    firebase.initializeApp({
      apiKey   : 'AIzaSyAxg9X6LQL6grs3LcdJxkuwrGEFSRHm3UM',
      projectId: 'myblog-9dbda'
    });

    function getCount(doc, increaseCount) {
      // IncreaseCount will be false when not in article page
      return doc.get().then(d => {
        var count = 0;
        if (!d.exists) { // Has no data, initialize count
          if (increaseCount) {
            doc.set({
              count: 1
            });
            count = 1;
          }
        } else { // Has data
          count = d.data().count;
          if (increaseCount) {
            // If first view this article
            doc.set({ // Increase count
              count: count + 1
            });
            count++;
          }
        }

        return count;
      });
    }

    function appendCountTo(el) {
      return count => {
        el.innerText = count;
      }
    }
  </script>
  <script>
    (function() {
      var db = firebase.firestore();
      var articles = db.collection('articles');

      if (CONFIG.page.isPost) { // Is article page
        var title = document.querySelector('.post-title').innerText.trim();
        var doc = articles.doc(title);
        var increaseCount = CONFIG.hostname === location.hostname;
        if (localStorage.getItem(title)) {
          increaseCount = false;
        } else {
          // Mark as visited
          localStorage.setItem(title, true);
        }
        getCount(doc, increaseCount).then(appendCountTo(document.querySelector('.firestore-visitors-count')));
      } else if (CONFIG.page.isHome) { // Is index page
        var promises = [...document.querySelectorAll('.post-title')].map(element => {
          var title = element.innerText.trim();
          var doc = articles.doc(title);
          return getCount(doc);
        });
        Promise.all(promises).then(counts => {
          var metas = document.querySelectorAll('.firestore-visitors-count');
          counts.forEach((val, idx) => {
            appendCountTo(metas[idx])(val);
          });
        });
      }
    })();
  </script>




      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  



<script type="text/javascript" charset="utf-8" src="/js/lazyload-plugin/lazyload.intersectionObserver.min.js"></script></body></html>